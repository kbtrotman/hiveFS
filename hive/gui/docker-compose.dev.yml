version: "3.9"
services:
  api:
    build:
      context: .
      dockerfile: Dockerfile.backend
      target: prod
    working_dir: /app
    command: npm run dev           # e.g., ts-node-dev / nodemon
    environment:
      - NODE_ENV=development
      - PORT=3000
    volumes:
      - ./api:/app
      - /app/node_modules
    ports:
      - "3000:3000"
    networks: [hivenet]

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
      target: build                # use Node stage for dev
    working_dir: /app
    command: npm run dev -- --host
    environment:
      - NODE_ENV=development
    volumes:
      - ./frontend:/app
      - /app/node_modules
    ports:
      - "5173:5173"                # Vite default; adjust as needed
    networks: [hivenet]

  # Optional: dev reverse proxy to unify ports
  devproxy:
    image: nginx:1.27-alpine
    depends_on: [frontend, api]
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./frontend/dist:/usr/share/nginx/html:ro
    ports:
      - "8080:80"
    networks: [hivenet]

networks:
  hivenet: {}
